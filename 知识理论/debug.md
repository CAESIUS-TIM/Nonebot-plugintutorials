# 写插件时候的一些技巧

> *Wait for perfection*

#### 善用搜索引擎

这其实是每个程序员都应该掌握的本领。当有什么需要使用的知识点遗忘了或者程序报了自己不会处理的错误的时候，善于使用百度，Google等搜索引擎搜索错误原因，去CSDN或者stackoverflow寻求解决方案，参考别人的意见。不要怕改了程序继续出错，只怕你不去试。

#### 善用print/log语句

Nonebot2的插件是需要启动Nonebot服务并接入消息收发端后才能正常运行，所以调试起来非常麻烦，虽然有Nonebug插件，但是其有一定的使用门槛。如果你不知道某个变量的内容到底是什么，那就直接使用`print`打印出其内容。比如在4_requestapp中要讲到的群申请`event.json`信息，你如果想知道它里面包含的内容和文本结构，将它打印出来或者写入本地文件都是好办法。当然，打印输出也可以使用`logger`模块，这个就看个人喜好了。

- [ ] logger包的使用方法(待写)

另外gocq和nonebot2是两个独立模块，可以说两者运行互不干扰。因此调试nonebot2的同时不需要重启gocq服务，另外频繁重启gocq更易导致bot被风控(在调试nonebot插件时请不要使用[NoneBot的go-cqhttp启动器](https://github.com/mnixry/nonebot-plugin-gocqhttp)插件，因为此插件会随着nonebot平台的重启而重启gocq服务)。

#### 遇到解决不了的问题时可以适当参考他人插件

很多时候有些程序处理思路是我们无法轻易想到的，这时候可以查看其它开源插件的源码(商店是个好地方)，以此得到灵感。**但是不要只是单纯的CV源码**，这样缺乏自己思考的过程，下次遇到这种问题还需要去CV。

- [ ] #### NoneBug(待写)

#### 做好权限管理

一些可以操作到机器人后台数据的指令尽量都要加上`permission`参数。为什么不用`rule`？因为rule只在响应器被触发的时候生效，后续的如`got`修饰器都不会生效，而`permission`适用于整个响应器执行过程，适用之后的多步响应器操作。

- [ ] 自定义规则rule类(待写)

#### 抽取共同函数/变量组成`utils`依赖包，方便统一管理。

插件较少时要管理的话较为容易，但是插件越来越多的时候，一些诸如日志输出、文件路径、适配器参数，数据库连接等功能代码会出现大量重复，较难调控。改一部分其它全都要去修改，非常麻烦。这时候就需要写一个统一的`utils`文件来管理了，具体做法参考Nonebot商店的成品bot。

#### 待续......